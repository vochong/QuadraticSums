from group48 import *

def equation22(k,m,b1,list2,q):
    a2 = k.a2
    p = k.p    
    q1 = q//20    
    m[9] = init2(20)
    m[10] = init2(20)    
    b1[9] = 0
    b1[10] = 0
    
    if q1%4==1:
        b1[0] = 0
        b1[1] = 0
        
    if q1%4==3:
        b1[0] = 1
        b1[1] = 1
        
    e = (p-1)//5
    a3 = exp2a(2*e*e,a2,p)
    a4 = exp2a(2,a3,p)
    print("\n \n in equation22 a3 = {0}  a4 = {1}".format(a3,a4))
    b1[2] = 2*a3[0]%p
    t = list2[3]+1
    a5 = exp2a(2*t*t,a2,p)
    a5 = exp2a(25,a5,p)
    a6 = [5*a5[0]%p , 5*a5[1]%p]
    print("\n in equation22 a5 = {0}  a6 = {1}".format(a5,a6))

    if q1%4==1:
        b1[5] = (a3[1]+(p-1)*a4[1]+2)%p
        b1[6] = (p-1)//2
        t1 = (p+7)//2
        b1[11] = (2*a4[0]+t1)%p
        b1[12] = (b1[5]+2*a4[0]+(p-1))%p    
    
    if q1%4==3:
        b1[5] = ((p-1)*a3[1]+a4[1]+2)%p
        b1[6] = (p+1)//2
        t1 = (p+7)//2
        b1[11] = (2*a4[0]+t1)%p
        b1[12] = ((p-1)*b1[5]+2*a3[0]+2)%p

    if q1%4==1:
        t1 = (p+1)//2
        b1[3] = (a3[0]+a3[1]+3)%p
        b1[4] = (a3[1]+a4[0]+t1)%p
        b1[7] = (b1[4]+2)%p
        b1[8] = (b1[3]+4*a4[0]+(p-2))%p

    if q1%4==3:
        t1 = (p-1)//2
        b1[3] = (a3[0]+(p-1)*a3[1]+3)%p
        b1[4] = (a3[1]+(p-1)*a4[0]+t1)%p
        b1[7] = ((p-1)*b1[4]+2)%p
        b1[8] = ((p-1)*b1[3]+4*a3[0]+4)%p

    if (q1%4==3 and (q1%5==3 or q1%5==4)):
        b1[3] = (b1[3]+a6[0])%p
        b1[4] = (b1[4]+a6[1])%p
        b1[7] = (b1[7]+a6[1])%p
        b1[8] = (b1[8]+(p-1)*a6[0])%p

    if (q1%4==1 and (q1%5==3 or q1%5==4)):
        b1[3] = (b1[3]+a6[0])%p
        b1[4] = (b1[4]+a6[1])%p
        b1[7] = (b1[7]+(p-1)*a6[1])%p
        b1[8] = (b1[8]+a6[0])%p


p1 = [881,2081,4481,5281,6481,7681]

p2 = [1361,2161,3361,3761,4561,6961,8161,15761]

p3 = [241,641,3041,4241,7841,12241]

p4 = [3121,4721,5521,7121,9521]

p5 = [1201,1601,2801,4001,4801]

p6 = [13121,13921,17921,21121,22721,25121]

p7 = [761,1321,1721,2281,2441,2521,3881]

""" The prime p should be of the form 40n+1 where gcd(5,n) = 1 """

p = 2281
k = group(0,p)
flag4 = 0
g = k.g
k = group(exp1(1,g,p),p)
k1 = group(exp1(25,k.g,p),p)

d4 = 1
q = (p-1)//(2*d4)
s1 = k.calc26(1,2*d4,q,p)
s2 = k1.calc26(1,2*d4,q//5,p)

k20 = init2(20)
for i in range(5):    
    h1 = k.series(s1[2*i],s1[2*i+1],0,2)
    k20[2*i] = h1[0]
    k20[2*i+1] = h1[1]
    h2 = k1.series(s2[2*i],s2[2*i+1],0,2)
    k20[2*i+10] = h2[0]
    k20[2*i+11] = h2[1]

print("\n \n k20 =",k20)
list1 = s1
list2 = s2
h1 = k.series(1,(p-1)//2,0,2)
h2 = k1.series(1,(p-1)//10,0,2)
t1 = inverse(h2[0],p)*h1[0]%p
print("\n h1 = {0}  h2 = {1}  t1 = {2}".format(h1,h2,t1))

m = init1(20,20)
b1 = init2(20)
b2 = init2(20)
a3 = exp2a((p-1)//5,k.a2,p)
s = (4*a3[0]+1)%p
t1 = (q//5)%5
if (t1==1 or t1==4):
    s = p-s
sq5 = s
print("\n s = ",s)

c = p-1
m[0] = [c,1,c,1,c,1,c,1,c,1,
        0,0,0,0,0,0,0,0,0,0]
c = p-1
m[1] = [0,0,0,0,0,0,0,0,0,0,
        c,1,c,1,c,1,c,1,c,1]
s = sq5
m[2] = [1,0,1,0,1,0,1,0,1,0,
        s,0,s,0,s,0,s,0,s,0]    

# 1  1/20
q1 = (p-1)//20
e = 2*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p
t1 = p-5
m[3] = [c1+1,s1,  c1+1,s1,  c1+c2,s1+s2,   c1+c2,s1+s2,    2*c2,2*s2,
        t1,0, t1,0, 0,0, 0,0, 0,0]
c1,s1 = p-s1,c1
c2,s2=  p-s2,c2
m[4] = [c1,s1+1,  c1,s1+1,  c1+c2,s1+s2,   c1+c2,s1+s2,    2*c2,2*s2,
        0,t1, 0,t1, 0,0, 0,0, 0,0]

# 2 1/40
q1 = (p-1)//40
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p
t1 = p-5
m[5] = [1,0,  c1,s1,  c1,s1,   c2,s2,    c2,s2,
        t1,0, 0,0, 0,0, 0,0, 0,0]
c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[6] = [0,1,  c1,s1,  c1,s1,  c2,s2,    c2,s2,
        0,t1, 0,0, 0,0, 0,0, 0,0]

# 3 3/40
q1 = 3*(p-1)//40
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p
t1 = p-5
m[7] = [2*c2+1,2*s2,   c1+c2+1,s1+s2,   c1+c2+1,s1+s2,
        2*c1+c2,2*s1+s2,  2*c1+c2,2*s1+s2,
        t1,0, t1,0, t1,0, 0,0, 0,0]
c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[8] = [2*c2,2*s2+1,   c1+c2,s1+s2+1,   c1+c2,s1+s2+1,
        2*c1+c2,2*s1+s2,  2*c1+c2,2*s1+s2,
        0,t1, 0,t1, 0,t1, 0,0, 0,0]

# 4
e1 = (p-1)//10
h1 = k.series(e1//4,5*e1//4,e1,2)
h2 = k.series(e1//4,5*e1//4,3*e1,2)
h3 = k.series(0,e1,0,2)
h4 = [(2*h1[0]+2*h2[0]+(p-1)*h3[0])%p, (2*h1[1]+2*h2[1]+(p-1)*h3[1])%p]
print("\n \n h1 = {0} \n \n h2 = {1}".format(h1,h2))
print("\n h3 = ",h3)
print("\n h4 = ",h4)
q1 = (p-1)//10
e = q1*q1//8
a3 = exp2a(e,k.a2,p)
a4 = exp2a(9,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p
t1 = (p+5)%p
m[9] = [c1+2*c2-1,s1+2*s2,   c1+2*c2-1,s1+2*s2,   2*c1+c2-1,2*s1+s2,
        2*c1+c2-1,2*s1+s2,  2*c1+2*c2,2*s1+2*s2,
        t1,0, t1,0, t1,0, t1,0, 0,0]
c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = (p+5)%p
m[10] = [c1+2*c2,s1+2*s2-1,   c1+2*c2,s1+2*s2-1,   2*c1+c2,2*s1+s2-1,
        2*c1+c2,2*s1+s2-1,  2*c1+2*c2,2*s1+2*s2,
        0,t1, 0,t1, 0,t1, 0,t1, 0,0]

# 5 1/10
q1 = (p-1)//10
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p
t1 = p-5
m[11] = [2*c1+c2+1,2*s1+s2,   2*c1+c2+1,2*s1+s2,   c1+2*c2+1,s1+2*s2,
        c1+2*c2+1,s1+2*s2,  2*c1+2*c2,2*s1+2*s2,
        t1,0, t1,0, t1,0, t1,0, 0,0]
c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[12] = [2*c1+c2,2*s1+s2+1,   2*c1+c2,2*s1+s2+1,   c1+2*c2,s1+2*s2+1,
        c1+2*c2,s1+2*s2+1,  2*c1+2*c2,2*s1+2*s2,
        0,t1, 0,t1, 0,t1, 0,t1, 0,0]

q1 = (p-1)//20
b2[0]=  0
b2[1] = 0
b2[2] = 0
e = (p-1)//5
a3 = exp2a(2*e*e,k.a2,p)
t1 = (2*a3[0]+3)%p
b2[3] = t1
b2[4] = 2*a3[1]%p
t2 = 5*inverse(2,p)%p
b2[5] = t2
a4 = exp2a(2,a3,p)
b2[6] = (a3[1]+(p-1)*a4[1])%p
b2[7] = b2[3]
b2[8] = b2[4]
t1 = (a3[0]+a4[0]+(p-2))%p
t2 = ((p-1)*a3[1]+a4[1])%p
b2[9] = t1
b2[10] = t2
b2[11] = b2[5]
b2[12] = b2[6]

q = (p-1)//2
if (q%16)==0:
    m[9] = init2(20)
    m[10] = init2(20)
    b2[0] = 1
    b2[1] = 1
    b2[2] = (p-sq5+(p-1))%p
    b2[3] = 3
    b2[4] = 0
    b2[5] = (b2[5]+(p-1))%p
    b2[6] = (p-b2[6])%p
    b2[7] = (sq5+2)%p
    b2[8] = 0
    b2[9] = 0
    b2[10] = 0
    b2[11] = (b2[11]+sq5+1)%p

q1 = q//40
q2 = q1%5
if  ((q%16)==0 and ((q2==2) or (q2==4))):
    t = list2[3]+1
    a3 = exp2a(2*t*t,k1.a2,p)
    b2[3] = (5*a3[0]+3)%p
    b2[4] = 5*a3[1]%p
    a4 = exp2a(q2*(p-1)//5,k.a2,p)
    b2[7] = (b2[3]+4*a4[0])%p
    b2[8] = b2[4]  

q2 = (p-1)//80
q3 = q2%5
if ((q2%2==1) and (p%32==17) and (q3==2 or q3==4)):
    q4 = q3//2
    a3 = exp2a(q4*(p-1)//5,k.a2,p)
    c1 = a3[0]
    s1 = (p-a3[1])%p
    t = list2[3]+1
    a3 = exp2a(2*t*t,k1.a2,p)
    print("\n \n a3 = ",a3)
    b2[3] = (2*c1+5*a3[0]+3)%p
    b2[4]=  (2*s1+5*a3[1])%p
    b2[7] = (2*c1+(p-5)*a3[0]+3)%p
    b2[8] = (2*s1+(p-5)*a3[1])%p

q = (p-1)//2
q1 = q//20
if q1%2==1:
    equation22(k,m,b2,list2,q)    

for i in range(20):
    b1[i] = multcnvl2(m[i],k20,p)

print("\n \n b1 = ",b1)
print()
print(" b2 = ",b2)
h20 = init2(4)
h20[0] = b1[3]
h20[1] = b1[4]
h20[2] = b1[7]
h20[3] = b1[8]
print("\n h20 = ",h20)
h21 = init2(4)
h21[0] = b1[5]
h21[1] = b1[6]
h21[2] = b1[11]
h21[3] = b1[12]
print("\n h21 = ",h21)
h1 = k.series(1,(p-1)//2,0,2)
print("\n h1 = ",h1)

# b3 = b2[:]
b3 = init2(20)
print("\n \n")
display(0,19,0,19,m,b3)
h1 = [0 for i in range(20)]
solve2(20,m,b3,p)
t1 = det(20,m)
print("\n \n det = ",t1)
display(0,19,0,19,m,b3)
l2solve(20,h1,b3,m,p)
print("after solve2 = ",h1)

