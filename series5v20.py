from group45 import *

"""
The prime p should be of the form p = 80n+1
where n = 1 mod 5 or n = 3 mod 5
The lists p1 and p3 are examples of primes
that could be used by this algorithm so that
it would get correct results
"""

p1 = [881,2081,4481,5281,6481,7681]

p2 = [1361,2161,3361,3761,4561,6961,8161,15761]

p3 = [241,641,3041,4241,7841,12241]

p4 = [3121,4721,5521,7121,9521]

p5 = [1201,1601,2801,4001,4801]

p = p3[3]

k = group(0,p)
flag4 = 0
g = k.g
k = group(exp1(1,g,p),p)
k1 = group(exp1(25,k.g,p),p)

d4 = 1
q = (p-1)//(2*d4)

s1 = k.calc26(1,2*d4,q,p)
s2 = k1.calc26(1,2*d4,q//5,p)

k20 = init2(20)
for i in range(5):
    
    h1 = k.series(s1[2*i],s1[2*i+1],0,2)
    k20[2*i] = h1[0]
    k20[2*i+1] = h1[1]
    h2 = k1.series(s2[2*i],s2[2*i+1],0,2)
    k20[2*i+10] = h2[0]
    k20[2*i+11] = h2[1]

print("\n \n  k20 = ",k20)

m = init1(20,20)
b1 = init2(20)
b2 = init2(20)
a3 = exp2a((p-1)//5,k.a2,p)
s = (4*a3[0]+1)%p
t1 = (q//5)%5
if (t1==1 or t1==4):
    s = p-s
sq5 = s
print("\n \n s = ",s)

c = p-1
m[0] = [c,1,c,1,c,1,c,1,c,1,
        0,0,0,0,0,0,0,0,0,0]

c = p-1
m[1] = [0,0,0,0,0,0,0,0,0,0,
        c,1,c,1,c,1,c,1,c,1]

s = sq5
m[2] = [1,0,1,0,1,0,1,0,1,0,
        s,0,s,0,s,0,s,0,s,0]     

# 1  1/20

q1 = (p-1)//20
e = 2*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = p-5
m[3] = [c1+1,s1,  c1+1,s1,  c1+c2,s1+s2,   c1+c2,s1+s2,    2*c2,2*s2,
        t1,0, t1,0, 0,0, 0,0, 0,0]

c1,s1 = p-s1,c1
c2,s2=  p-s2,c2
m[4] = [c1,s1+1,  c1,s1+1,  c1+c2,s1+s2,   c1+c2,s1+s2,    2*c2,2*s2,
        0,t1, 0,t1, 0,0, 0,0, 0,0]

# 2 1/40

q1 = (p-1)//40
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = p-5
m[5] = [1,0,  c1,s1,  c1,s1,   c2,s2,    c2,s2,
        t1,0, 0,0, 0,0, 0,0, 0,0]

c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[6] = [0,1,  c1,s1,  c1,s1,  c2,s2,    c2,s2,
        0,t1, 0,0, 0,0, 0,0, 0,0]

# 2b 1/40
"""

q1 = (p-1)//40
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = p-5
m[5] = [1,0,  c1,s1,  c1,s1,   c2,s2,    c2,s2,
        t1,0, 0,0, 0,0, 0,0, 0,0]

c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[6] = [0,1,  c1,s1,  c1,s1,  c2,s2,    c2,s2,
        0,t1, 0,0, 0,0, 0,0, 0,0]
"""

# 3 3/40

q1 = 3*(p-1)//40
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = p-5
m[7] = [2*c2+1,2*s2,   c1+c2+1,s1+s2,   c1+c2+1,s1+s2,
        2*c1+c2,2*s1+s2,  2*c1+c2,2*s1+s2,
        t1,0, t1,0, t1,0, 0,0, 0,0]


c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[8] = [2*c2,2*s2+1,   c1+c2,s1+s2+1,   c1+c2,s1+s2+1,
        2*c1+c2,2*s1+s2,  2*c1+c2,2*s1+s2,
        0,t1, 0,t1, 0,t1, 0,0, 0,0]


# 4
t1 = (p-1)%32
s = p-1
if t1==0:
    s = 1
e1 = (p-1)//10
h1 = k.series(e1//4,5*e1//4,e1,2)
h2 = k.series(e1//4,5*e1//4,3*e1,2)
h3 = k.series(0,e1,0,2)
h4 = [(2*h1[0]+2*h2[0]+s*h3[0])%p, (2*h1[1]+2*h2[1]+s*h3[1])%p]
print("\n \n h1 = {0} \n \n h2 = {1}".format(h1,h2))
print("\n h3 = ",h3)
print("\n h4 = ",h4)

q1 = (p-1)//10
e = q1*q1//8
a3 = exp2a(e,k.a2,p)
a4 = exp2a(9,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = s*(p-5)%p
m[9] = [c1+2*c2+s,s1+2*s2,   c1+2*c2+s,s1+2*s2,   2*c1+c2+s,2*s1+s2,
        2*c1+c2+s,2*s1+s2,  2*c1+2*c2,2*s1+2*s2,
        t1,0, t1,0, t1,0, t1,0, 0,0]

c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = s*(p-5)%p
m[10] = [c1+2*c2,s1+2*s2+s,   c1+2*c2,s1+2*s2+s,   2*c1+c2,2*s1+s2+s,
        2*c1+c2,2*s1+s2+s,  2*c1+2*c2,2*s1+2*s2,
        0,t1, 0,t1, 0,t1, 0,t1, 0,0]

"""
t1 = 5*s%p
m[13] = [0,0, 0,0, 0,0, 0,0, 0,0,
         t1,0, t1,0, t1,0, t1,0, 0,0]
     
m[14] = [0,0, 0,0, 0,0, 0,0, 0,0,
         0,t1, 0,t1, 0,t1, 0,t1, 0,0]
"""


# 5 1/10

q1 = (p-1)//10
e = 8*q1*q1
a3 = exp2a(e,k.a2,p)
a4 = exp2a(4,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = p-5
m[11] = [2*c1+c2+1,2*s1+s2,   2*c1+c2+1,2*s1+s2,   c1+2*c2+1,s1+2*s2,
        c1+2*c2+1,s1+2*s2,  2*c1+2*c2,2*s1+2*s2,
        t1,0, t1,0, t1,0, t1,0, 0,0]


c1,s1 = p-s1,c1
c2,s2 = p-s2,c2
t1 = p-5
m[12] = [2*c1+c2,2*s1+s2+1,   2*c1+c2,2*s1+s2+1,   c1+2*c2,s1+2*s2+1,
        c1+2*c2,s1+2*s2+1,  2*c1+2*c2,2*s1+2*s2,
        0,t1, 0,t1, 0,t1, 0,t1, 0,0]


# test 1

# for p = 6481
"""
m[11] = [6214+20,556,  6214+20,6342,  2943,0,  1429+20,2893,   1429+20,3171,
         p-40,0, p-40,0, 0,0, p-100,0, p-100,0]


# m[12] = [1,0, 1,0, 0,0, 1,0, 1,0,
#         0,0, 0,0, 0,0, 0,0, 0,0]

# m[13] = [0,0,   0,0,   0,0,  0,0,  0,0,
#         4,0,  4,0,  0,0,  10,0,  10,0]

"""

# test 2
"""
q1 = (p-1)//20
e = q1*q1//2
a3 = exp2a(e,k.a2,p)
a4 = exp2a(9,a3,p)
c1 = a3[0]%p
s1 = a3[1]%p
c2 = a4[0]%p
s2 = a4[1]%p

t1 = (p+5)%p
m[11] = [2*c1,2*s1,   c1+c2,s1+s2,   c1+c2,s1+s2,
        c2-1,s2,  c2-1,s2,
        0,0, 0,0, 0,0, t1,0, t1,0]

c1,s1 = p-s1,c1
c2,s2 = p-s2,c2

t1 = (p+5)%p
m[12] = [2*c1,2*s1,   c1+c2,s1+s2,   c1+c2,s1+s2,
        c2,s2-1,  c2,s2-1,
        0,0, 0,0, 0,0, 0,t1, 0,t1]
"""


# test 3
"""
q1 = (p-1)//16
if q1%2==0:
    m[9] = init2(20)
    m[10] = init2(20)
    
m[13] = init2(20)
m[14] = init2(20)

e = (p-1)//20
e1 = e*e//8
a3 = exp2a(e1,k.a2,p)
a4 = exp2a(9,a3,p)
c1 = a3[0]
s1 = a3[1]
c2 = a4[0]
s2 = a4[1]

m[13] = [3*c1+c2,3*s1+s2,   c1+2*c2,s1+2*s2+1,   2*c2,2*s2+2,
        c1+2*c2,s1+2*s2+1,  3*c1+c2,3*s1+s2,
        0,0, 0,p-5, 0,p-10, 0,p-5, 0,0]
"""

"""
m[13] = [3*c1+c2,3*s1+s2,   c1+2*c2,s1+2*s2-1,   2*c2,2*s2-2,
        c1+2*c2,s1+2*s2-1,  3*c1+c2,3*s1+s2,
        0,0, 0,5, 0,10, 0,5, 0,0]
"""

"""
t = p-5
m[14] = [0,0,   0,1,   0,2,  0,1,  0,0,
        0,0, 0,t, 0,2*t, 0,t, 0,0]

m[15] = [0,0,   0,0,   0,0,  0,0,  0,0,
        0,0, 0,1, 0,2, 0,1, 0,0]

m[16] = [0,0,   0,0,   0,2,  0,0,  0,0,
        0,0, 0,0, 0,0, 0,0, 0,0]

m[17] = [0,0,   0,0,   0,0,  0,0,  0,0,
        0,0, 0,0, 0,2, 0,0, 0,0]
"""

for i in range(20):
    b1[i] = multcnvl2(m[i],k20,p)

b2[0]=  0
b2[1] = 0
b2[2] = 0
e = (p-1)//5
a3 = exp2a(2*e*e,k.a2,p)
t1 = (2*a3[0]+3)%p
b2[3] = t1
b2[4] = 2*a3[1]%p
t2 = 5*inverse(2,p)%p
b2[5] = t2
a4 = exp2a(2,a3,p)
b2[6] = (a3[1]+(p-1)*a4[1])%p
b2[7] = b2[3]
b2[8] = b2[4]
t1 = (a3[0]+a4[0]+(p-2))%p
t2 = ((p-1)*a3[1]+a4[1])%p
b2[9] = t1
b2[10] = t2
b2[11] = b2[5]
b2[12] = b2[6]

q1 = (p-1)//16
if (q1%2)==0:
    b2[0] = 1
    b2[1] = 1
    b2[2] = (p-sq5+(p-1))%p
    b2[3] = 3
    b2[4] = 0
    b2[5] = (b2[5]+(p-1))%p
    b2[6] = (p-b2[6])%p
    b2[7] = (sq5+2)%p
    b2[8] = 0
    b2[9] = (b2[11]+sq5+1)%p
    b2[10] = b2[12]
    b2[11] = (b2[11]+sq5+1)%p

print("\n \n b1 = ",b1)
print()
print(" b2 = ",b2)

h1 = k.series(1,(p-1)//2,0,2)
print("\n \n h1 = ",h1)
print("\n \n")

b3 = init2(20)
v1 = init2(20)

print("\n \n")
display(0,19,0,19,m,b3)

h1 = [0 for i in range(20)]

solve2(20,m,v1,p)
t1 = det(20,m)
print("\n \n det = ",t1)
display(0,19,0,19,m,v1)
l2solve(20,h1,v1,m,p)
print("after solve2 = ",h1)
print("\n \n")

